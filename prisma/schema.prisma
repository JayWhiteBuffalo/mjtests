
generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions", "multiSchema"]
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  extensions = [postgis]
  schemas = ["private"]
}

model BusinessRequest {
  id String @id
  producer Json?
  referrer String?
  status String
  type String
  user Json
  vendor Json?

  archived Boolean @default(false)
  createdAt DateTime @default(now())
  createdBy User @relation(fields: [createdById], references: [id], name: "createdBy")
  createdById String
  updatedAt DateTime @updatedAt
  updatedBy User @relation(fields: [updatedById], references: [id], name: "updatedBy")
  updatedById String
  version Int @default(1)

  @@schema("private")
}

model ImageRef {
  assetId String?
  fileSize Int?
  lastModified DateTime?
  originalFilename String?
  producer Producer? @relation(fields: [producerId], references: [id], name: "all")
  producerId String?
  producerMain Producer[] @relation("main")
  product Product? @relation(fields: [productId], references: [id], name: "all")
  productId String?
  productMain Product[] @relation("main")
  publicId String @id
  size Int[]
  updatedAt DateTime @updatedAt
  uploadedBy User? @relation(fields: [uploadedById], references: [id])
  uploadedById String?
  vendor Vendor? @relation(fields: [vendorId], references: [id], name: "all")
  vendorId String?
  vendorMain Vendor[] @relation("main")

  @@schema("private")
}

model Producer {
  contact Json
  flags Json
  id String @id
  imageRefs ImageRef[] @relation("all")
  license Json
  location Json
  mainImageRef ImageRef? @relation(fields: [mainImageRefId], references: [publicId], name: "main")
  mainImageRefId String?
  name String
  products Product[]
  signupStatus Json
  slug String @unique
  users UserOnProducer[]

  archived Boolean @default(false)
  createdAt DateTime @default(now())
  createdBy User @relation(fields: [createdById], references: [id], name: "createdBy")
  createdById String
  updatedAt DateTime @updatedAt
  updatedBy User @relation(fields: [updatedById], references: [id], name: "updatedBy")
  updatedById String
  version Int @default(1)

  @@schema("private")
}

model Product {
  batch String?
  brand String?
  concentrateType String?
  cultivar String?
  flags Json
  id String @id
  imageRefs ImageRef[] @relation("all")
  isDraft Boolean
  mainImageRef ImageRef? @relation(fields: [mainImageRefId], references: [publicId], name: "main")
  mainImageRefId String?
  name String
  normalizedTerps Json?
  potency Json
  price Float?
  pricePerGram Float?
  producer Producer? @relation(fields: [producerId], references: [id])
  producerId String?
  productType String?
  rating Json?
  slug String? @unique
  subspecies String?
  terps Json?
  vendor Vendor? @relation(fields: [vendorId], references: [id])
  vendorId String?
  weight Float?

  archived Boolean @default(false)
  createdAt DateTime @default(now())
  createdBy User @relation(fields: [createdById], references: [id], name: "createdBy")
  createdById String
  updatedAt DateTime @updatedAt
  updatedBy User @relation(fields: [updatedById], references: [id], name: "updatedBy")
  updatedById String
  version Int @default(1)

  @@schema("private")
}

model User {
  id String @id
  name String?
  producers UserOnProducer[]
  profileImageUrl String?
  roles String[] @default([])
  vendors UserOnVendor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdBusinessRequests BusinessRequest[] @relation("createdBy")
  createdProducers Producer[] @relation("createdBy")
  createdProducts Product[] @relation("createdBy")
  createdVendors Vendor[] @relation("createdBy")
  updatedBusinessRequests BusinessRequest[] @relation("updatedBy")
  updatedProducers Producer[] @relation("updatedBy")
  updatedProducts Product[] @relation("updatedBy")
  updatedVendors Vendor[] @relation("updatedBy")
  uploadedImageRefs ImageRef[]

  @@schema("private")
}

model UserOnProducer {
  role String
  updatedAt DateTime @updatedAt
  user User @relation(fields: [userId], references: [id])
  userId String
  producer Producer @relation(fields: [producerId], references: [id])
  producerId String

  @@id([userId, producerId])
  @@schema("private")
}

model UserOnVendor {
  role String
  updatedAt DateTime @updatedAt
  user User @relation(fields: [userId], references: [id])
  userId String
  vendor Vendor @relation(fields: [vendorId], references: [id])
  vendorId String

  @@id([userId, vendorId])
  @@schema("private")
}

model Vendor {
  contact Json
  flags Json
  id String @id
  imageRefs ImageRef[] @relation("all")
  latLng Unsupported("postgis.geometry(Point, 4326)")?
  license Json
  location Json
  mainImageRef ImageRef? @relation(fields: [mainImageRefId], references: [publicId], name: "main")
  mainImageRefId String?
  name String @unique
  operatingStatus String
  products Product[]
  rating Json?
  schedule Json
  signupStatus Json
  slug String @unique
  users UserOnVendor[]

  archived Boolean @default(false)
  createdAt DateTime @default(now())
  createdBy User @relation(fields: [createdById], references: [id], name: "createdBy")
  createdById String
  updatedAt DateTime @updatedAt
  updatedBy User @relation(fields: [updatedById], references: [id], name: "updatedBy")
  updatedById String
  version Int @default(1)

  @@index([latLng], name: "blockgroup_idx", type: Gist)
  @@schema("private")
}
